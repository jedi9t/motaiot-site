<script>
async function signOutUser() {
    // 假设您已实现 /api/auth/signout 函数来清除会话 cookie
    // 如果没有，直接清除 cookie 并刷新页面也可以
    document.cookie = "__session=; Path=/; HttpOnly; Secure; Max-Age=0"; 
    window.location.reload(); 
}

async function getProviders() {
    // 调用您的原生 Providers API
    const response = await fetch('/api/auth/providers');
    
    // 如果 API 失败，返回一个默认按钮
    if (!response.ok) {
        console.error("Failed to fetch providers, API returned non-OK status.");
        return; 
    }
    
    const providers = await response.json();
    
    const container = document.getElementById('auth-buttons-container');
    if (container && providers) {
        container.innerHTML = ''; 
        for (const providerId in providers) {
            const provider = providers[providerId];
            const button = document.createElement('a');
            
            // 使用 btn-outline-primary 样式
            button.className = 'btn btn-outline-primary btn-sm mx-1'; 
            
            button.href = provider.signinUrl; 
            button.textContent = `LOGIN ${provider.name}`;
            container.appendChild(button);
        }
    }
}

async function checkSession() {
    // 调用您的原生 Session API
    const response = await fetch('/api/auth/session');
    
    // 假设您的 /api/auth/session 始终返回 JSON，即使未登录
    const session = await response.json(); 
    
    const container = document.getElementById('auth-buttons-container');
    
    if (session && session.user) {
        // --- 修正：已登录状态 ---
        const userName = session.user.name || session.user.email.split('@')[0];
        
        container.innerHTML = `
            <span class="text-text-dark dark:text-white font-semibold mr-3 whitespace-nowrap">
                Welcome, ${userName}
            </span>
            <a href="#" onclick="signOutUser()" class="btn btn-danger btn-sm mx-1">LOGOUT</a>
        `;
    } else {
        // 未登录状态
        getProviders(); // 渲染登录按钮
    }
}

document.addEventListener('DOMContentLoaded', checkSession);
</script>

<div id="auth-buttons-container" class="flex items-center"></div>